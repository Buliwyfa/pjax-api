/*! pjax-api v3.0.0 https://github.com/falsandtru/pjax-api | (c) 2016, falsandtru | GPL-2.0 License */
define="function"==typeof define&&define.amd?define:function(){"use strict";var e="pjax-api",t={};return function r(n,i,o){return o?void o.apply(this,i.map(function(e){switch(e){case"require":return"function"==typeof require?require:void 0;case"exports":return n.indexOf("/")===-1?t[n]="undefined"==typeof exports?self[n]=self[n]||{}:exports:t[n]=t.hasOwnProperty(n)?t[n]:{};default:return".d"===e.slice(-2)&&{}||t.hasOwnProperty(e)&&t[e]||"function"==typeof require&&require(e)||self[e]}})):void r(e,n,i)}}();var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("src/lib/url",["require","exports"],function(e,t){"use strict";var r=function(){function e(e){this.parser=document.createElement("a"),this.URL,this.parser.href=e+""||location.href}return Object.defineProperty(e.prototype,"href",{get:function(){return this.parser.href},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"domain",{get:function(){return this.protocol+"//"+this.host},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this.parser.protocol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"host",{get:function(){return this.parser.host},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hostname",{get:function(){return this.parser.hostname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"port",{get:function(){return this.parser.port},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return""+this.pathname+this.query},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dir",{get:function(){return this.pathname.split("/").slice(0,-1).concat("").join("/")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"file",{get:function(){return this.pathname.split("/").pop()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathname",{get:function(){return""+("/"===this.parser.pathname[0]?"":"/")+this.parser.pathname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"query",{get:function(){return this.parser.search},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hash",{get:function(){return this.parser.hash},enumerable:!0,configurable:!0}),e}();t.Url=r}),define("src/layer/domain/data/config",["require","exports","spica","src/lib/url"],function(e,t,r,n){"use strict";var i=function(){function e(e){this.areas=["body"],this.link="a:not([target])",this.form="form:not([method])",this.replace="",this.fetch={timeout:3e3,wait:0},this.load={head:"base, meta, link",css:!0,script:!0,ignore:'[href^="chrome-extension://"]',reload:"",logger:""},this.balance={bounds:[""],weight:1,random:0,client:{hosts:[],support:{balance:/msie|trident.+ rv:|chrome|firefox|safari/i,redirect:/msie|trident.+ rv:|chrome|firefox|safari/i},cookie:{balance:"balanceable",redirect:"redirectable"}},server:{header:"X-Ajax-Host",expiry:2592e5}},this.store={expiry:108e5},this.progressbar="display:none;position:absolute;bottom:0;left:0;width:0;height:2px;background:rgb(40, 105, 255);",this.scope={"/":{}},void r.extend(this,e),void Object.freeze(this)}return e.prototype.filter=function(e){if("string"!=typeof e.href)return!1;var t=new n.Url(e.href);return/^https?:$/.test(t.protocol)&&/^$|\.(html?|php)$/.test(t.file)},e.prototype.rewrite=function(e,t,r){},e.prototype.fallback=function(e,t){if(e instanceof HTMLAnchorElement)return void window.location.assign(e.href);if(e instanceof HTMLFormElement)return void window.location.assign(e.action);if(e instanceof Window)return void window.location.reload(!0);throw t},e}();t.Config=i}),define("src/layer/data/model/validation/url",["require","exports"],function(e,t){"use strict";function r(e){return e=e.trim(),n.href=e||location.href,e=n.href,e=encodeURI(decodeURI(e)).replace(/%25/g,"%"),e=e.replace(/["`^|\\<>{}\[\]\s].*/,"")}var n=document.createElement("a");t.validateUrl=r}),define("src/layer/data/model/canonicalization/url",["require","exports","src/layer/data/model/validation/url"],function(e,t,r){"use strict";function n(e){return e.replace(/(?:%\w{2})+/g,function(e){return e.toUpperCase()})}t.canonicalizeUrl=n}),define("src/layer/application/config/scope",["require","exports","spica","src/layer/domain/data/config"],function(e,t,r,n){"use strict";function i(e,t){return r.Sequence.from(Object.keys(e.scope).sort().reverse()).dropWhile(function(e){return!o(t.orig,e)&&!o(t.dest,e)}).take(1).filter(function(e){return!!o(t.orig,e)&&o(t.dest,e)}).map(function(t){return e.scope[t]}).map(function(t){return t?r.Just(new n.Config(r.extend({},e,t))):r.Nothing}).read().reduce(function(e,t){return t},r.Nothing)}function o(e,t){var n=/\/|[^\/]+\/?/g;return r.Sequence.zip(r.Sequence.cycle([e]),r.Sequence.from(c(t))).map(function(e){var t=e[0],r=e[1];return[t.match(n)||[],r.match(n)||[]]}).filter(function(e){var t=e[0],r=e[1];return t.length>=r.length}).filter(function(e){var t=e[0],n=e[1];return r.Sequence.zip(r.Sequence.from(t),r.Sequence.from(n)).takeWhile(function(e){var t=e[0],r=e[1];return u(t,r)}).read().length===n.length}).take(1).read().length>0}function c(e){return r.Sequence.from((e.match(/{.*?}|[^{]*/g)||[]).map(function(e){return"{"===e[0]?e.slice(1,-1).split(","):[e]})).mapM(r.Sequence.from).map(function(e){return e.join("")}).read()}function u(e,t){return r.Sequence.from(e.split("")).map(function(e,t){return[e,t]}).scan(function(t,n){var i=t[0],o=t[1],c=o[0],u=o.slice(1),a=n[0],s=n[1];switch(c){case"?":return[i+a,u];case"*":return 0===u.length?[i+a,s+1===e.length?[]:[c]]:a===u[0]?[i+a,u.slice(1)]:[i+a,r.concat([c],u)];default:return a===c?[i+a,u]:[i,[]]}},["",t.split("")]).dropWhile(function(e){var t=e[1];return t.length>0}).map(function(e){var t=e[0];return t}).take(1).filter(function(t){return t===e}).read().length>0}t.scope=i,t.compare=o,t.expand=c,t.match=u}),define("src/lib/dom",["require","exports"],function(e,t){"use strict";function r(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild?t.firstElementChild:t}function n(e,t){return Array.from(e.querySelectorAll(t||"_")||[])}function i(e,t,r,n){function i(e){e._currentTarget=e.currentTarget,void r(e)}return void 0===n&&(n=!1),void e.addEventListener(t,i,a(n)),function(){return void e.removeEventListener(t,i,a(n))}}function o(e,t,r,n){void 0===n&&(n=!1);var o=!1,c=i(e,t,function(e){return void c(),o=!0,r(e)},a(n));return function(){return o?void 0:void c()}}function c(e,t,r,i){function o(o){function c(e){e._currentTarget=e.currentTarget,void e._currentTarget.removeEventListener(r,c),void i(e)}var u=o.target.closest(t);u&&void n(e,t).filter(function(e){return e===u}).forEach(function(e){return e.addEventListener(r,c,!1)})}return void e.addEventListener(r,o,!0),function(){return void e.removeEventListener(r,o,!0)}}function u(e){return Array.from(e.elements).filter(function(e){return e.name&&!e.disabled&&(e.checked||!/^(?:checkbox|radio)$/i.test(e.type))&&/^(?:input|select|textarea|keygen)/i.test(e.nodeName)&&!/^(?:submit|button|image|reset|file)$/i.test(e.type)}).map(function(e){return[encodeURIComponent(e.name),encodeURIComponent(null===e.value?"":e.value.replace(/\r?\n/g,"\r\n"))].join("=")}).join("&")}function a(e){return s?e:e.capture}t.parse=r,t.find=n,t.bind=i,t.once=o,t.delegate=c,t.serialize=u;var s=!1;try{var d=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("test",null,d)}catch(l){}}),define("src/layer/domain/event/router",["require","exports","src/lib/url","src/layer/data/model/canonicalization/url","src/layer/data/model/validation/url","src/lib/dom"],function(e,t,r,n,i,o){"use strict";var c=function(){function e(t){this.original=t,this.source=this.original._currentTarget,this.type=this.original.type.toLowerCase(),this.request=new e.Request(this.source,this.type),this.location=new e.Location(this.request.url),void Object.freeze(this)}return e}();t.RouterEvent=c;var c;!function(e){var t;!function(e){e.click="click",e.submit="submit",e.popstate="popstate"}(t=e.Type||(e.Type={}));var c;!function(e){e.GET="GET",e.POST="POST"}(c=e.Method||(e.Method={}));var u=function(){function e(e,t){this.source=e,this.eventType=t,this.data=this.method===c.POST?new FormData(this.source):null,void this.url,void Object.freeze(this)}return Object.defineProperty(e.prototype,"method",{get:function(){if(this.method_)return this.method_;switch(this.eventType){case t.click:return this.method_=c.GET;case t.submit:return this.method_=this.source.method.toUpperCase()===c.POST?c.POST:c.GET;case t.popstate:return this.method_=c.GET;default:throw new TypeError}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){if(this.url_)return this.url_;switch(this.eventType){case t.click:return this.url_=n.canonicalizeUrl(i.validateUrl(this.source.href));case t.submit:return this.url_=n.canonicalizeUrl(i.validateUrl(this.source.method.toUpperCase()===c.POST?this.source.action.split(/[?#]/).shift():this.source.action.split(/[?#]/).shift().concat("?"+o.serialize(this.source))));case t.popstate:return this.url_=n.canonicalizeUrl(i.validateUrl(window.location.href));default:throw new TypeError}},enumerable:!0,configurable:!0}),e}();e.Request=u;var a=function(){function e(e){this.target=e,this.orig=new r.Url(n.canonicalizeUrl(i.validateUrl(window.location.href))),this.dest=new r.Url(this.target),void Object.freeze(this)}return e}();e.Location=a}(c=t.RouterEvent||(t.RouterEvent={}))}),define("src/layer/domain/router/model/eav/entity",["require","exports"],function(e,t){"use strict";var r=function(){function e(e,t,r){this.event=e,this.config=t,this.state=r,void Object.freeze(this)}return e}();t.RouterEntity=r;var r;!function(e){var t=function(){function e(e,t){this.script=e,this.cancelable=t,void Object.freeze(this)}return e}();e.State=t}(r=t.RouterEntity||(t.RouterEntity={}))}),define("src/layer/domain/router/module/fetch/html",["require","exports","spica","src/lib/dom"],function(e,t,r,n){"use strict";function i(e){var t=(new DOMParser).parseFromString(e,"text/html");return void c(t),t}function o(e){var t=window.document.implementation.createHTMLDocument(""),r=n.find(n.parse(e.slice(0,e.search(/<\/title>/i)+8)),"title").reduce(function(e,t){return t.textContent||e},"");return"function"==typeof DOMParser&&(t.title=r),void t.open(),void t.write(e),void t.close(),t.title!==r&&(t.title=t.querySelector("title").textContent||""),void c(t),t}function c(e){return void u(e).forEach(function(e){var t=e[0],r=e[1];return t.textContent=r.textContent})}function u(e){return n.find(e,"noscript").filter(function(e){return e.children.length>0}).map(function(e){var t=e.cloneNode(!0);return t.textContent=e.innerHTML,[e,t]})}function a(e){try{var t='\n<html lang="en" class="html">\n  <head>\n    <link href="/">\n    <title>&amp;</title>\n    <noscript><style>/**/</style></noscript>\n  </head>\n  <body>\n    <noscript>noscript</noscript>\n    <a href="/"></a>\n    <script>document.head.remove();</script>\n  </body>\n</html>\n',r=e(t);switch(!1){case!!r:case r.URL&&decodeURI(r.URL)===decodeURI(window.location.href):case"&"===r.title:case!!r.querySelector('html.html[lang="en"]'):case!!r.querySelector("head>link").href:case!!r.querySelector("body>a").href:case!r.querySelector("head>noscript>*"):case"document.head.remove();"===r.querySelector("script").innerHTML:case"<style>/**/</style>"===r.querySelector("head>noscript").textContent:case"noscript"===r.querySelector("body>noscript").textContent:throw void 0}return!0}catch(n){return!1}}t.parse=[o,i].reduce(function(e,t){return e.bind(function(){return a(t)?r.Left(t):e})},r.Right(function(){return r.Nothing})).extract(function(e){return function(t){return r.Just(e(t))}}),t.fix=c,t._fixNoscript=u}),define("src/layer/domain/router/model/eav/value/fetch",["require","exports","src/layer/domain/router/module/fetch/html"],function(e,t,r){"use strict";var n=function(){function e(e){this.xhr=e,this.response=new(function(){function e(e){this.xhr=e,this.headers={},this.document=this.xhr.responseXML||r.parse(this.xhr.responseText);var t=":",n=/^[0-9A-z\-]+$/;void this.xhr.getAllResponseHeaders().split("\n").filter(function(e){return e.indexOf(t)>0}).map(function(e){return[e.slice(0,e.indexOf(t)).trim(),e.slice(e.indexOf(t)+1).trim()]}).filter(function(e){var t=e[0];return n.test(t)}).reduce(function(e,t){var r=t[0],n=t[1];return e[r]=n,e},this.headers),void Object.freeze(this.headers),void Object.freeze(this)}return e}())(this.xhr),void Object.freeze(this)}return e}();t.FetchValue=n}),define("src/lib/error",["require","exports"],function(e,t){"use strict";var r=function(e){function t(t){e.call(this,"Pjax: "+t)}return __extends(t,e),t}(Error);t.PjaxError=r}),define("src/layer/domain/data/error",["require","exports","src/lib/error"],function(e,t,r){"use strict";var n=function(e){function t(t){e.call(this,"Domain: "+t)}return __extends(t,e),t}(r.PjaxError);t.DomainError=n}),define("src/layer/domain/router/module/fetch/xhr",["require","exports","spica","src/layer/domain/router/model/eav/value/fetch","src/layer/domain/data/error"],function(e,t,r,n,i){"use strict";function o(e,t,o,u,a){function s(e,t,r){return void e.either(0).fmap(t).extract(r)}var d=new XMLHttpRequest,l=new Promise(function(e){return setTimeout(e,u.wait)});return new Promise(function(l){return void d.open(e,t+"",!0),d.responseType=/chrome|firefox|edge/i.test(window.navigator.userAgent)?"document":"text",d.timeout=u.timeout,void d.setRequestHeader("X-Pjax","1"),void d.send(o),void d.addEventListener("abort",function(){return void s(a,function(){return void l(r.Left(new i.DomainError("XHR request is aborted.")))},function(e){return void l(r.Left(e))})}),void d.addEventListener("error",function(){return void s(a,function(){return void l(r.Left(new i.DomainError("XHR request is failed.")))},function(e){return void l(r.Left(e))})}),void d.addEventListener("timeout",function(){return void s(a,function(){return void l(r.Left(new i.DomainError("XHR request is timeout.")))},function(e){return void l(r.Left(e))})}),void d.addEventListener("load",function(){return void s(a,function(){return void c(d).fmap(function(e){return void l(r.Right(new n.FetchValue(e)))}).extract(function(e){return void l(r.Left(e))})},function(e){return void l(r.Left(e))})}),void a.listeners.add(function(){return void d.abort()})}).then(function(e){return l.then(function(){return e})})}function c(e){return r.Right(e).bind(function(e){return u(e.getResponseHeader("Content-Type"),s)?r.Right(e):r.Left(new i.DomainError("XHR response content type is mismatched."))})}function u(e,t){return r.Sequence.intersect(r.Sequence.from(a(e||"").sort()),r.Sequence.from(a(t).sort()),function(e,t){return e.localeCompare(t)}).take(1).read().length>0}function a(e){return e.split(";").map(function(e){return e.trim()}).filter(function(e){return e.length>0})}var s="text/html";t.xhr=o,t.verify=c,t.match=u}),define("src/layer/domain/router/service/fetch/api",["require","exports","src/layer/domain/router/module/fetch/xhr"],function(e,t,r){"use strict";function n(e,t,n){var i=e.method,o=e.url,c=e.data,u=r.xhr(i,o,c,t,n);return void window.dispatchEvent(new Event("pjax:fetch")),u}t.fetch=n}),define("src/layer/domain/router/model/eav/value/update",["require","exports"],function(e,t){"use strict";var r=function(){function e(e){this.document=e,void Object.freeze(this.document),void Object.freeze(this)}return e}();t.UpdateValue=r}),define("src/layer/domain/router/module/update/blur",["require","exports"],function(e,t){"use strict";function r(e){e.activeElement!==e.body&&(void e.activeElement.blur(),void e.body.focus())}t.blur=r}),define("src/layer/domain/router/module/update/url",["require","exports","src/layer/domain/event/router"],function(e,t,r){"use strict";function n(e,t,r,n,c){switch(!0){case o(r,n,c):return void window.history.replaceState(null,t,e.dest.href+"");case i(r,e):return void window.history.pushState(null,t,e.dest.href+"");default:return}}function i(e,t){if(t.orig.href===t.dest.href)return!1;switch(e){case r.RouterEvent.Type.click:case r.RouterEvent.Type.submit:return!0;case r.RouterEvent.Type.popstate:return!1;default:throw new TypeError(e)}}function o(e,t,n){switch(e){case r.RouterEvent.Type.click:case r.RouterEvent.Type.submit:return t.matches(n.trim()||"_");case r.RouterEvent.Type.popstate:return!1;default:throw new TypeError(e)}}t.url=n,t._isRegisterable=i,t._isReplaceable=o}),define("src/layer/domain/router/module/update/title",["require","exports"],function(e,t){"use strict";function r(e){e.dst.title=e.src.title}t.title=r}),define("src/layer/domain/router/module/update/sync",["require","exports","spica"],function(e,t,r){"use strict";function n(e,t,r){function n(e){return e?e.parentElement:t}return void 0===r&&(r={before:o,remove:c}),void e.forEach(function(e){var t=e[0],i=e[1];return void r.before(n(i),t.slice(-1).some(function(e){return!!i&&e.outerHTML===i.outerHTML})?t.slice(0,-1):t,i),i&&0===t.length?void r.remove(i):void 0})}function i(e,t,n){function i(e,t,n){return e.reduce(function(e,i){return 0===t.length?(void e.set(null,r.concat(e.get(null)||[],[i])),e):t.reduce(function(e,t){return e.bind(function(e){return!e.has(t)&&n(i,t)?(void e.set(t,r.concat(e.get(null)||[],[i])),void e["delete"](null),r.Left(e)):r.Right(e)})},r.Right(e)).fmap(function(e){return void e.set(null,r.concat(e.get(null)||[],[i])),e}).extract(function(e){return e})},new Map)}var o=i(e,t,n);return void t.filter(function(e){return!o.has(e)}).forEach(function(e){return void o.set(e,[])}),Array.from(o.entries()).map(function(e){var t=e[0],r=e[1];return[r,t]})}function o(e,t,r){return void t.map(function(t){return e.ownerDocument.importNode(t.cloneNode(!0),!0)}).forEach(function(t){return void e.insertBefore(t,r)})}function c(e){return void e.parentElement.removeChild(e)}t.sync=n,t.pair=i}),define("src/layer/domain/router/module/update/head",["require","exports","src/layer/domain/router/module/update/sync","src/lib/dom"],function(e,t,r,n){"use strict";function i(e,t,i){return i+=t.indexOf("link")>-1?', link[rel~="stylesheet"]':"",void r.sync(r.pair(n.find(e.src,t).filter(function(e){return!e.matches(i.trim()||"_")}),n.find(e.dst,t).filter(function(e){return!e.matches(i.trim()||"_")}),o),e.dst)}function o(e,t){return e.outerHTML===t.outerHTML}t.head=i}),define("src/layer/domain/router/module/update/script",["require","exports","spica","src/lib/dom","src/layer/data/model/canonicalization/url","src/layer/data/model/validation/url"],function(require,exports,spica_6,dom_4,url_6,url_7){"use strict";function script(e,t,r,n,i){function o(t,n){return t.bind(function(t){return i.evaluate(n).fmap(function(n){return n.parentElement.matches(r.logger.trim()||"_")?void i.log(n,e.dst):void 0,t.concat([n])})})}void 0===i&&(i={request:request,evaluate:evaluate,log:log});var c=dom_4.find(e.src,"script").filter(function(e){return!e.type||/(?:application|text)\/(?:java|ecma)script/i.test(e.type)}).filter(function(e){return!e.matches(r.ignore.trim()||"_")}).filter(function(e){return!e.hasAttribute("src")||(t.indexOf(url_6.canonicalizeUrl(url_7.validateUrl(e.src)))===-1||e.matches(r.reload.trim()||"_"))});return new Promise(function(e,t){return void Promise.all(c.reduce(function(e,t){return spica_6.concat(e,[i.request(t)])},[])).then(n.promise).then(function(e){return e.reduce(o,spica_6.Right([]))}).then(e,t)})}function escape(e){var t=e.hasAttribute("src")?e.getAttribute("src"):null,r=e.innerHTML;return void e.removeAttribute("src"),e.innerHTML="",function(){return e.innerHTML=" ",e.innerHTML=r,"string"==typeof t?void e.setAttribute("src",t):void 0}}function request(e){if(e.hasAttribute("src")){var t=new XMLHttpRequest;return void t.open("GET",e.src,!0),void t.send(),new Promise(function(r,n){return["load","abort","error","timeout"].forEach(function(i){switch(i){case"load":return void t.addEventListener(i,function(){return void r([e,t.response])});default:return void t.addEventListener(i,function(e){return void n(e)})}})})}return Promise.resolve([e,e.innerHTML])}function evaluate(_a){var script=_a[0],code=_a[1];try{return void eval(code),script.hasAttribute("src")&&void script.dispatchEvent(new Event("load")),spica_6.Right(script)}catch(err){return script.hasAttribute("src")&&void script.dispatchEvent(new Event("error")),spica_6.Left(err)}}function log(e,t){return dom_4.find(t,e.parentElement.id?"#"+e.parentElement.id:e.parentElement.tagName).slice(-1).reduce(function(r,n){e=t.importNode(e.cloneNode(!0),!0);var i=escape(e);return void n.appendChild(e),void i(),!0},!1)}exports.script=script,exports.escape=escape,exports._request=request,exports._evaluate=evaluate,exports._log=log}),define("src/layer/domain/router/module/update/content",["require","exports","spica","src/lib/dom","src/layer/domain/router/module/update/script"],function(e,t,r,n,i){"use strict";function o(e,t,o){function u(e){function t(e){var t=n.find(e.src,"script").map(i.escape).reduce(function(e,t){return function(){return void e(),void t()}},function(){});void o.replace(e.src,e.dst),void t()}return e.src.map(function(t,r){return{src:window.document.importNode(e.src[r].cloneNode(!0),!0),dst:e.dst[r]}}).map(function(e){return void t(e),n.find(e.src,"img, iframe, frame").map(s)}).reduce(r.concat,[])}return void 0===o&&(o={replace:function(e,t){return void t.parentNode.replaceChild(e,t)}}),c(e,t).fmap(function(e){var t=e[1];return t.map(u).reduce(r.concat,[])}).fmap(function(t){return Promise.all(t).then(function(t){return[e,t]})})}function c(e,t){function i(e,t){function i(t){function i(e){function t(e){return e.src.length>0&&e.src.length===e.dst.length}return t(e)?r.Just(e):r.Nothing}function o(t){return{src:n.find(e.src,t),dst:n.find(e.dst,t)}}return i(o(t))}return a(t).reduce(function(e,t){return e.bind(function(e){return i(t).fmap(function(t){return r.concat(e,[t])})})},r.Just([]))}return t.reduce(function(t,n){return r.Maybe.mplus(t,i(e,n).fmap(function(e){return[n,e]}))},r.Nothing)}function u(e,t){function i(e,t){return a(t).reduce(function(t,i){return t.bind(function(){return n.find(e,i).length>0?t:r.Nothing})},r.Just(t))}return r.Sequence.from(t).bind(function(t){return r.Sequence.from(i(e,t).fmap(function(e){return[e]}).extract(function(){return[]}))})}function a(e){return(e.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[]).map(function(e){return e.trim()})}function s(e){return Promise.race(["load","abort","error"].map(function(t){return new Promise(function(r){return void n.once(e,t,r)})}))}t.content=o,t.separate=c,t.match=u,t._split=a,t._wait=s}),define("src/layer/domain/router/module/update/css",["require","exports","src/lib/dom","src/layer/domain/router/module/update/sync"],function(e,t,r,n){"use strict";function i(e,t){var i='link[rel~="stylesheet"], style';return void n.sync(n.pair(r.find(e.src,i).filter(function(e){return!e.matches(t.trim()||"_")}),r.find(e.dst,i).filter(function(e){return!e.matches(t.trim()||"_")}),o),e.dst)}function o(e,t){switch(e.tagName.toLowerCase()){case"link":return e.href===t.href;case"style":return e.innerHTML.trim()===t.innerHTML.trim();default:return!1}}t.css=i}),define("src/layer/domain/router/module/update/focus",["require","exports","src/lib/dom"],function(e,t,r){"use strict";function n(e){return void r.find(e,"body, [autofocus]").slice(-1).filter(function(t){return t!==e.activeElement}).forEach(function(e){return void e.focus()})}t.focus=n}),define("src/layer/domain/router/module/update/scroll",["require","exports","spica","src/layer/domain/event/router","src/lib/url","src/layer/data/model/canonicalization/url","src/layer/data/model/validation/url","src/lib/dom"],function(e,t,r,n,i,o,c,u){"use strict";function a(e,t,r,u){function a(e){var t=e.top,r=e.left;r=r>=0?r:window.pageXOffset,t=t>=0?t:window.pageYOffset,void u.scroll.call(window,r,t)}switch(void 0===u&&(u={hash:s,scroll:window.scrollTo,position:function(e){return{top:0,left:0}}}),e){case n.RouterEvent.Type.click:return void(u.hash(t,r.hash,u)||a(r));case n.RouterEvent.Type.submit:return void a(r);case n.RouterEvent.Type.popstate:return void a(u.position(new i.Url(o.canonicalizeUrl(c.validateUrl(window.location.href))).path));default:throw new TypeError(e)}}function s(e,t,n){return void 0===n&&(n={scroll:window.scrollTo}),r.Just(t.split("#").pop()||"").bind(function(e){return e.length>0?r.Just(e):r.Nothing}).bind(function(t){return u.find(e,"#"+t+', [name="'+t+'"]').reduce(function(e,t){return r.Just(e.extract(function(){return t}))},r.Nothing)}).fmap(function(e){return void n.scroll.call(window,window.pageXOffset,window.pageYOffset+e.getBoundingClientRect().top|0),!0}).extract(function(){return!1})}t.scroll=a,t.hash=s}),define("src/layer/domain/router/service/update/api",["require","exports","spica","src/layer/domain/router/model/eav/value/update","src/layer/domain/router/module/update/blur","src/layer/domain/router/module/update/url","src/layer/domain/router/module/update/title","src/layer/domain/router/module/update/head","src/layer/domain/router/module/update/content","src/layer/domain/router/module/update/css","src/layer/domain/router/module/update/script","src/layer/domain/router/module/update/focus","src/layer/domain/router/module/update/scroll"],function(e,t,r,n,i,o,c,u,a,s,d,l,f){"use strict";function p(e,t,p){var v=e.event,h=e.config,m=e.state,y=t.response,w=new n.UpdateValue({src:y.document,dst:p.document}).document,g=[];return(new r.HNil).push(r.Just(0)).modify(function(e){return e.bind(function(){return a.separate(w,h.areas).fmap(function(e){var t=e[0];return void h.rewrite(w.src,t,"")})})}).modify(function(e){return e.fmap(function(){return void window.dispatchEvent(new Event("pjax:unload"))})}).modify(function(e){return e.fmap(function(){return void i.blur(w.dst)})}).modify(function(e){return e.fmap(function(){return void o.url(v.location,w.src.title,v.type,v.source,h.replace)})}).modify(function(e){return e.fmap(function(){return void c.title(w)})}).modify(function(e){return e.fmap(function(){return void u.head({src:w.src.head,dst:w.dst.head},h.load.head,h.load.ignore)})}).modify(function(e){return e.bind(function(){return a.content(w,h.areas)})}).extend(function(e){return e.fmap(function(e){return void g.push(e)})}).modify(function(e){return e.fmap(function(){return h.load.css?void s.css({src:w.src.head,dst:w.dst.head},h.load.ignore):void 0})}).modify(function(e){return e.fmap(function(){return h.load.css?void s.css({src:w.src.body,dst:w.dst.body},h.load.ignore):void 0})}).modify(function(e){return e.fmap(function(){return void l.focus(w.dst)})}).modify(function(e){return e.fmap(function(){return void f.scroll(v.type,w.dst,{hash:v.location.dest.hash,top:0,left:0},{hash:f.hash,scroll:p.scroll,position:p.position})})}).modify(function(e){return e.fmap(function(){return h.load.script?d.script(w,m.script,h.load,m.cancelable):Promise.resolve(r.Right([]))})}).modify(function(e){return e.fmap(function(e){return e.then(function(t){return t.fmap(function(t){return void p.document.dispatchEvent(new Event("pjax:ready")),void g.push(e),void Promise.all(g).then(function(){return void window.dispatchEvent(new Event("pjax:load"))}),t})})})})}t.update=p}),define("src/layer/data/schema/path",["require","exports","src/lib/url"],function(e,t,r){"use strict";var n=function(){function e(){this.host=new r.Url("").host,this.title="",this.position={top:void 0,left:void 0}}return e}();t.PathSchema=n}),define("src/layer/data/store/path",["require","exports","localsocket","src/layer/data/schema/path","src/lib/url"],function(e,t,r,n,i){"use strict";var o=r.socket("path",{schema:function(){return new n.PathSchema}});void o.recent(100,function(e){return void o.sync(e)}),t.store={link:function(e){return o.link(new i.Url(e+"").path,2592e5)}}}),define("src/layer/domain/store/path",["require","exports","src/layer/data/store/path"],function(e,t,r){"use strict";function n(e){return r.store.link(e).title}function i(e,t){return r.store.link(e).title=t}function o(e){return r.store.link(e).position}function c(e,t){r.store.link(e).position=t}t.loadTitle=n,t.saveTitle=i,t.loadPosition=o,t.savePosition=c}),define("src/layer/domain/router/service/api",["require","exports","spica","src/layer/domain/router/model/eav/entity","src/layer/domain/router/service/fetch/api","src/layer/domain/router/service/update/api","src/layer/domain/router/module/update/content","src/layer/domain/store/path","src/layer/domain/data/error"],function(e,t,r,n,i,o,c,u,a){"use strict";function s(e,t){return r.Just(0).bind(function(){return c.match(window.document,e.config.areas).take(1).read().length>0?r.Just(0):r.Nothing}).fmap(function(){return void u.saveTitle(e.event.location.orig.path,t.document.title),i.fetch(e.event.request,e.config.fetch,e.state.cancelable).then(function(r){return r.fmap(function(r){return o.update(e,r,{document:t.document,scroll:window.scrollTo,position:u.loadPosition})})}).then(function(e){return e.fmap(function(e){return e.head().extract(function(){return Promise.resolve(r.Left(new a.DomainError("Routing is failed.")))})})}).then(function(n){return n.fmap(function(r){return void u.saveTitle(e.event.location.dest.path,t.document.title),r}).extract(function(e){return Promise.resolve(r.Left(e))})})}).extract(function(){return Promise.resolve(r.Left(new a.DomainError("Routing is failed.")))})}t.RouterEntity=n.RouterEntity,t.route=s}),define("src/layer/domain/router/api",["require","exports","src/layer/domain/router/service/api"],function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}n(r)}),define("src/layer/application/data/error",["require","exports","src/lib/error"],function(e,t,r){"use strict";var n=function(e){function t(t){e.call(this,"Application: "+t)}return __extends(t,e),t}(r.PjaxError);t.ApplicationError=n}),define("src/layer/application/store/path",["require","exports","src/layer/domain/store/path"],function(e,t,r){"use strict";t.loadTitle=r.loadTitle,t.savePosition=r.savePosition}),define("src/layer/application/api",["require","exports","spica","src/layer/domain/data/config","src/layer/application/config/scope","src/layer/domain/event/router","src/layer/domain/router/api","src/layer/application/data/error","src/layer/application/store/path","src/layer/domain/router/module/fetch/html"],function(e,t,r,n,i,o,c,u,a,s){"use strict";function d(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function l(e,t,n,a){var s=new o.RouterEvent(t).location;return i.scope(e,{orig:s.orig.pathname,dest:s.dest.pathname}).fmap(function(e){return c.route(new c.RouterEntity(new o.RouterEvent(t),e,new c.RouterEntity.State(n.script,n.cancelable)),a)}).extract(function(){return Promise.resolve(r.Left(new u.ApplicationError("Pjax is ignored by config.")))})}t.Config=n.Config,t.route=l,d(a),t.parse=s.parse}),define("src/layer/interface/module/view/click",["require","exports","spica","src/lib/dom"],function(e,t,r,n){"use strict";var i=function(){function e(e,t,i){var o=this;this.sv=new(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r.Supervisor)),this.close=function(){return void o.sv.terminate()},void this.sv.register([],function(){return void o.sv.events.exit.once([],n.delegate(e.documentElement,t,"click",i))}),void this.sv.cast([],void 0)}return e}();t.ClickView=i}),define("src/layer/interface/module/view/submit",["require","exports","spica","src/lib/dom"],function(e,t,r,n){"use strict";var i=function(){function e(e,t,i){var o=this;this.sv=new(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r.Supervisor)),this.close=function(){return void o.sv.terminate()},void this.sv.register([],function(){return void o.sv.events.exit.once([],n.delegate(e.documentElement,t,"submit",i))}),void this.sv.cast([],void 0)}return e}();t.SubmitView=i}),define("src/layer/interface/module/view/navigation",["require","exports","spica","src/lib/dom"],function(e,t,r,n){"use strict";
var i=function(){function e(e,t){var i=this;this.sv=new(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r.Supervisor)),this.close=function(){return void i.sv.terminate()},void this.sv.register([],function(){return void i.sv.events.exit.once([],n.bind(e,"popstate",t))}),void this.sv.cast([],void 0)}return e}();t.NavigationView=i}),define("src/layer/interface/module/view/scroll",["require","exports","spica","src/lib/dom"],function(e,t,r,n){"use strict";var i=function(){function e(e,t){var i=this;this.sv=new(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r.Supervisor)),this.close=function(){return void i.sv.terminate()};var o=0;void this.sv.register([],function(){return void i.sv.events.exit.once([],n.bind(e,"scroll",function(e){return o=o>0?o:setTimeout(function(){return o=0,void t(e)},300)},{passive:!0}))}),void this.sv.cast([],void 0)}return e}();t.ScrollView=i}),define("src/layer/interface/service/state/script",["require","exports","spica","src/layer/data/model/canonicalization/url","src/layer/data/model/validation/url","src/lib/dom"],function(e,t,r,n,i,o){"use strict";t.script=[],void r.Tick(function(){return void r.concat(t.script,o.find(document,"script").filter(function(e){return e.hasAttribute("src")}).map(function(e){return n.canonicalizeUrl(i.validateUrl(e.src))}))})}),define("src/layer/interface/service/state/initialization",["require","exports","spica","src/layer/interface/service/state/script"],function(e,t,r){"use strict";t.initialization=new Promise(function(e){return void r.Tick(e)})}),define("src/layer/interface/service/state/url",["require","exports","src/layer/data/model/canonicalization/url","src/layer/data/model/validation/url"],function(e,t,r,n){"use strict";var i=r.canonicalizeUrl(n.validateUrl(location.href));t.documentUrl={get href(){return i},sync:function(){return i=r.canonicalizeUrl(n.validateUrl(location.href))}}}),void setTimeout(function(){return window.history.scrollRestoration="manual"},0),void window.addEventListener("unload",function(){return window.history.scrollRestoration="auto"},!0),define("src/layer/interface/service/progressbar",["require","exports"],function(e,t){"use strict";function r(e){void n.setAttribute("style",e)}var n=document.createElement("div");void window.addEventListener("pjax:fetch",function(){return void document.documentElement.appendChild(n)}),void window.addEventListener("pjax:fetch",function(){return n.style.width="5%"}),void window.addEventListener("pjax:unload",function(){return n.style.width="80%"}),void document.addEventListener("pjax:ready",function(){return n.style.width="90%"}),void window.addEventListener("pjax:load",function(){return n.style.width="100%"}),void window.addEventListener("pjax:load",function(){return void n.remove()}),t.progressbar=r}),define("src/layer/interface/data/error",["require","exports","src/lib/error"],function(e,t,r){"use strict";var n=function(e){function t(t){e.call(this,"Interface: "+t)}return __extends(t,e),t}(r.PjaxError);t.InterfaceError=n}),define("src/layer/interface/service/router",["require","exports","spica","src/layer/application/api","src/layer/data/model/canonicalization/url","src/layer/data/model/validation/url","src/layer/interface/service/state/url","src/layer/interface/service/progressbar","src/layer/interface/data/error"],function(e,t,r,n,i,o,c,u,a){"use strict";function s(e,t,r,s){return void d.cast([],new a.InterfaceError("Pjax is aborted.")),void d.register([],function(e){throw void r.cancelable.cancel(e)}),void u.progressbar(e.progressbar),n.route(e,t,r,s).then(function(e){return void d.terminate([]),void e.bind(r.cancelable.either).fmap(function(e){return void(t=r.script).push.apply(t,e.map(function(e){return i.canonicalizeUrl(o.validateUrl(e.src))})),void c.documentUrl.sync();var t}).extract()})["catch"](function(n){return void d.terminate([]),void r.cancelable.maybe(0).fmap(function(){return void console.error(n),void Promise.reject(e.fallback(t._currentTarget,n))}).extract(function(){return 0})})}var d=new(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r.Supervisor));t.route=s}),define("src/layer/interface/service/gui",["require","exports","spica","src/layer/application/api","src/lib/url","src/layer/data/model/canonicalization/url","src/layer/data/model/validation/url","src/layer/interface/module/view/click","src/layer/interface/module/view/submit","src/layer/interface/module/view/navigation","src/layer/interface/module/view/scroll","src/layer/interface/service/state/initialization","src/layer/interface/service/state/url","src/layer/interface/service/state/script","src/layer/interface/service/router","src/layer/application/api","src/lib/dom","../service/state/scroll-restoration"],function(e,t,r,n,i,o,c,u,a,s,d,l,f,p,v,h,m){"use strict";function y(e){return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey}function w(e,t){return void 0===t&&(t=new i.Url(f.documentUrl.href)),t.domain===e.domain}function g(e,t){return void 0===t&&(t=new i.Url(f.documentUrl.href)),t.domain===e.domain&&t.path===e.path&&t.hash!==e.hash}function b(e){var t=document.createElement("a");return t.href=e,new Promise(function(e){return void m.once(t,"click",function(t){return void t.preventDefault(),void e(t)}),void h.parse("").extract().body.appendChild(t),void t.click(),void t.remove()})}var x=new(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r.Supervisor)),E=function(){function e(t,m){var b=this;void 0===m&&(m={document:window.document}),this.option=t,this.io=m,this.config=new n.Config(this.option),void e.sv.terminate([]),void e.sv.register([],function(){return void e.sv.events.exit.once([],new u.ClickView(b.io.document,b.config.link,function(e){return void r.Just(new i.Url(o.canonicalizeUrl(c.validateUrl(e._currentTarget.href)))).bind(function(t){return!y(e)&&w(t)&&!g(t)&&b.config.filter(e._currentTarget)?r.Just(0):r.Nothing}).fmap(function(){return void e.preventDefault(),l.initialization.then(function(){return v.route(b.config,e,{router:x,script:p.script,cancelable:new r.Cancelable},b.io)})}).extract(function(){return Promise.resolve()})["catch"](function(){return void window.location.assign(e._currentTarget.href)})}).close),void e.sv.events.exit.once([],new a.SubmitView(b.io.document,b.config.form,function(e){return void r.Just(new i.Url(o.canonicalizeUrl(c.validateUrl(e._currentTarget.action)))).bind(function(t){return!y(e)&&w(t)?r.Just(0):r.Nothing}).fmap(function(){return void e.preventDefault(),l.initialization.then(function(){return v.route(b.config,e,{router:x,script:p.script,cancelable:new r.Cancelable},b.io)})}).extract(function(){return Promise.resolve()})["catch"](function(){return void window.location.assign(e._currentTarget.action)})}).close),void e.sv.events.exit.once([],new s.NavigationView(window,function(e){return void r.Just(new i.Url(o.canonicalizeUrl(c.validateUrl(window.location.href)))).bind(function(e){return w(e)&&!g(e)?r.Just(e):r.Nothing}).fmap(function(t){return h.loadTitle(t)?m.document.title=h.loadTitle(t):void 0,l.initialization.then(function(){return v.route(b.config,e,{router:x,script:p.script,cancelable:new r.Cancelable},b.io)})}).extract(function(){return Promise.resolve()})["catch"](function(){return void window.location.reload(!0)})}).close),void e.sv.events.exit.once([],new d.ScrollView(window,function(){return void r.Just(window).fmap(function(e){var t=e.pageXOffset,r=e.pageYOffset;return f.documentUrl.href===new i.Url(o.canonicalizeUrl(c.validateUrl(window.location.href))).href?void h.savePosition(new i.Url(f.documentUrl.href).path,{top:r,left:t}):void 0}).extract()}).close)}),void e.sv.cast([],void 0)}return e.assign=function(e,t,i){return void 0===i&&(i={document:window.document}),void b(e).then(function(e){return l.initialization.then(function(){return v.route(new n.Config(t),e,{router:x,script:p.script,cancelable:new r.Cancelable},i)})})},e.replace=function(e,t,i){return void 0===i&&(i={document:window.document}),void b(e).then(function(e){return l.initialization.then(function(){return v.route(new n.Config(r.extend({},t,{replace:"*"})),e,{router:x,script:p.script,cancelable:new r.Cancelable},i)})})},e.prototype.assign=function(t){return void e.assign(t,this.option,this.io)},e.prototype.replace=function(t){return void e.replace(t,this.option,this.io)},e.sv=new(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r.Supervisor)),e}();t.GUI=E,t.click=b}),define("src/layer/interface/service/api",["require","exports","src/layer/interface/service/gui"],function(e,t,r){"use strict";t.API=r.GUI}),define("src/export",["require","exports","src/layer/interface/service/api","src/layer/interface/service/api"],function(e,t,r,n){"use strict";t.Pjax=r.API,t["default"]=n.API}),define("pjax-api",["require","exports","src/export","src/export","./src/import"],function(e,t,r,n){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}i(r),t["default"]=n["default"]});
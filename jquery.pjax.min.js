/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.19.4
 * @updated 2013/10/17
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(c){var r=window,K=document,w=void 0,x=["settings"];c.fn.pjax=c.pjax=function(y){function L(a,b){b.id=1;x[b.id]=b;b.link&&c(a).undelegate(b.link,b.nss.click).delegate(b.link,b.nss.click,b.id,function(a){a.timeStamp=(new Date).getTime();if(1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey||r.location.protocol!==this.protocol||r.location.host!==this.host||r.location.pathname===this.pathname&&r.location.search===this.search&&r.location.hash!==this.hash)return this;var b,t,p;b=x[a.data];
t=this.href;b.area=g(b.options.area,null,[a,t])||b.options.area;b.landing&&(b.landing=!1);if(!b.disable&&c(b.area).length&&(!b.scope||B(b.scope,r.location.href,t)))return b.cache[a.type.toLowerCase()]&&(p=A(b.history,t)),C(b,this,a,t,!0,p),a.preventDefault(),!1});b.form&&c(a).undelegate(b.form,b.nss.submit).delegate(b.form,b.nss.submit,b.id,function(a){a.timeStamp=(new Date).getTime();var b,t,p;b=x[a.data];t=this.action+("GET"===a.target.method.toUpperCase()?"?"+c(a.target).serialize():"");b.area=
g(b.options.area,null,[a,t])||b.options.area;b.landing&&(b.landing=!1);if(!b.disable&&c(b.area).length&&(!b.scope||B(b.scope,r.location.href,t)))return b.cache[a.type.toLowerCase()]&&b.cache[a.target.method.toLowerCase()]&&(p=A(b.history,t)),C(b,this,a,t,!0,p),a.preventDefault(),!1});c(r).unbind(b.nss.popstate).bind(b.nss.popstate,b.id,function(a){a.timeStamp=(new Date).getTime();var b,t,p;b=x[a.data];t=r.location.href;b.area=g(b.options.area,null,[a,t])||b.options.area;if(b.landing){if(b.landing===
r.location.href){b.landing=!1;return}b.landing=!1}if(!b.disable&&c(b.area).length)return b.cache[a.type.toLowerCase()]&&(p=A(b.history,t)),C(b,this,a,t,!1,p),a.preventDefault(),!1});c("script[src]").each(function(){this.src in b.log.script||(b.log.script[this.src]=!0)})}function C(a,b,h,v,t,p){function z(q){var d=a.validate?a.validate.clone({name:"jquery.pjax.js - update()"}):!1;d&&d.start();d&&(d.scope=function(a){return eval(a)});d&&d.test("1",1,0,"update()");d&&d.test("++",1,0,"start");a:if(a.speedcheck&&
a.log.speed.name.push("update"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==g(a.callbacks.update.before,b,[h,a.parameter,m,k,l],a.callbacks.async)){var f=window,p=document,e,z,r;try{d&&d.test("++",1,0,"try");d&&d.test("++",1,q?0:[a.contentType,l.getResponseHeader("Content-Type")],"content-type");if(!q&&!RegExp(a.contentType.replace(/\s*[,;]\s*(.|$)/g,function(a,b){return b?"|"+b:""}),"i").test(l.getResponseHeader("Content-Type")))throw Error("throw: content-type mismatch");
d&&d.test("++",q?"'usable'":"'unusable'",0,"cache");q&&!1!==g(a.callbacks.update.cache.load.before,b,[h,a.parameter,q],a.callbacks.async)&&(l=q.XMLHttpRequest,m=l.responseText,k=q.dataType,e=q.title,z=q.css,r=q.script,g(a.callbacks.update.cache.load.after,b,[h,a.parameter,q],a.callbacks.async));d&&d.test("++",1,0,"initialize");var n=c(m),s=0<n.filter("title").length,u=a.area.replace(/(\((.*?(\(.*?\).*?)?)*?\)|\S)(,|$)/g,function(a,b,c,h,d){return b+(d?"|":"")}).split(/\s*\|(?!=)\s*/);e=e?e:s?n.filter("title").text():
c("<span/>").html(E(m,"<title>([^<]*)</title>").join()).text();if(!c(a.area).length||!n.find(a.area).add(n.filter(a.area)).length)throw Error("throw: area length mismatch");d&&d.test("++",1,v,"url");if(!1!==g(a.callbacks.update.url.before,b,[h,a.parameter,m,k,l],a.callbacks.async)){t&&v!==f.location.href&&f.history.pushState(f.history.state,f.opera||-1!==f.navigator.userAgent.toLowerCase().indexOf("opera")?e:p.title,v);switch(!0){case /Mobile(\/\w+)? Safari/i.test(f.navigator.userAgent):a.off(),f.history.back(),
f.history.forward(),a.on()}g(a.callbacks.update.url.after,b,[h,a.parameter,m,k,l],a.callbacks.async)}d&&d.test("++",1,e,"title");!1!==g(a.callbacks.update.title.before,b,[h,a.parameter,m,k,l],a.callbacks.async)&&(p.title=e,g(a.callbacks.update.title.after,b,[h,a.parameter,m,k,l],a.callbacks.async));d&&d.test("++",1,0,"scroll");var y=function(b){var d;switch(h.type.toLowerCase()){case "click":case "submit":d=b&&"function"===typeof a.scrollLeft?g(a.scrollLeft,null,[h]):a.scrollLeft,d=0<=d?d:0,d=null===
d?c(f).scrollLeft():parseInt(Number(d)),b=b&&"function"===typeof a.scrollTop?g(a.scrollTop,null,[h]):a.scrollTop,b=0<=b?b:0,b=null===b?c(f).scrollTop():parseInt(Number(b)),c(f).scrollTop()===b&&c(f).scrollLeft()===d||f.scrollTo(d,b)}};y(!1);d&&d.test("++",1,u,"content");if(!1!==g(a.callbacks.update.content.before,b,[h,a.parameter,m,k,l],a.callbacks.async)){c(a.area).children("."+a.nss.class4html+"-check").remove();for(var p=0,D;D=u[p];p++)c(D).html(n.find(D).add(n.filter(D)).contents()).append(c("<div/>",
{"class":a.nss.class4html+"-check",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));c(document).trigger(a.gns+".DOMContentLoaded");g(a.callbacks.update.content.after,b,[h,a.parameter,m,k,l],a.callbacks.async)}d&&d.test("++",
1,0,"css");var B=function(){var d=a.validate?a.validate.clone({name:"jquery.pjax.js - load_css()"}):!1;d&&d.start();d&&(d.scope=function(a){return eval(a)});if(!1!==g(a.callbacks.update.css.before,b,[h,a.parameter,m,k,l],a.callbacks.async)){z=z?z:s?n.find('link[rel~="stylesheet"], style').add(n.filter('link[rel~="stylesheet"], style')):E(m,"(<link[^>]*?rel=.[^\"']*stylesheet[^>]*>|<style[^>]*>(.|[\n\r])*?</style>)");A(a.history,v)&&(A(a.history,v).css=z);c('link[rel~="stylesheet"], style').filter(function(){return c.data(this,
a.nss.data,!0)});for(var f=0,q,e=c('link[rel~="stylesheet"]'),t=c("style"),p;q=z[f];f++){p=!1;q=s?q:c(q)[0];switch(q.tagName.toLowerCase()){case "link":if(e.filter(function(){if(p||this.href!==q.href)return!1;p=!0;c.removeData(this,a.nss.data);return!0}).length)continue;break;case "style":if(t.filter(function(){if(p||!c.data(this,a.nss.data)||this.innerHTML!==q.innerHTML)return!1;p=!0;c.removeData(this,a.nss.data);return!0}).length)continue}c("head").append(q);q=null}c('link[rel~="stylesheet"], style').filter(function(){return c.data(this,
a.nss.data)}).remove();c(document).trigger(a.gns+".ready");!1!==g(a.callbacks.update.css.after,b,[h,a.parameter,m,k,l],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}d&&d.end()};a.load.css&&setTimeout(function(){B()},a.load.async||0);!a.load.css&&c(document).trigger(a.gns+".ready");d&&d.test("++",1,0,"script");var F=function(d){var f=a.validate?a.validate.clone({name:"jquery.pjax.js - load_script()"}):!1;f&&f.start();
f&&(f.scope=function(a){return eval(a)});if(!1!==g(a.callbacks.update.script.before,b,[h,a.parameter,m,k,l],a.callbacks.async)){var q=[];r=r?r:s?n.find("script").add(n.filter("script")):E(m,"(?:[^'\"]|^s*)(<script[^>]*>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");A(a.history,v)&&(A(a.history,v).script=r);for(var p=0,e;e=r[p];p++)if(e=s?e:c(e)[0],"sync"!==d||e.defer)"async"===d&&e.defer||!e.childNodes.length&&e.src in a.log.script||(e.src&&(a.log.script[e.src]=!0),c.when?(e=e.src?c.ajax(c.extend(!0,{},
a.ajax,{url:e.src,dataType:"script",async:!1,global:!1})):c.Deferred().resolve(a.load.execute?e:w),q.push(e)):c("head").append(e),e=null);c.when&&q.length&&c.when.apply(null,q).done(function(){for(var a=0,b;b=arguments[a];a++)0<Number(b.nodeType)&&(!b.type||-1<b.type.toLowerCase().indexOf("text/javascript"))&&eval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});!1!==g(a.callbacks.update.script.after,b,[h,a.parameter,m,k,l],a.callbacks.async)&&(a.speedcheck&&
"async"===d&&a.log.speed.name.push("script"),a.speedcheck&&"async"===d&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}f&&f.end()};a.load.script&&setTimeout(function(){F("async")},a.load.async||0);a.load.script&&!a.load.sync&&setTimeout(function(){F("sync")},a.load.async||0);d&&d.test("++",1,0,"rendering");setTimeout(function(){var d=c(a.area).children("."+a.nss.class4html+"-check");d.filter(function(){return this.clientWidth||c(this).is(":hidden")}).length===d.length?!1!==g(a.callbacks.update.rendering.before,
b,[h,a.parameter],a.callbacks.async)&&(d.remove(),a.load.script&&a.load.sync&&setTimeout(function(){F("sync")},a.load.async||0),y(!0),c(window).trigger(a.gns+".load"),!1!==g(a.callbacks.update.rendering.after,b,[h,a.parameter],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("rendering"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name))):d.length&&setTimeout(function(){arguments.callee()},
a.interval)},0);d&&d.test("++",1,0,"cache");q||!(a.cache.click||a.cache.submit||a.cache.popstate)||"submit"===h.type.toLowerCase()&&!a.cache[h.target.method.toLowerCase()]||!1===g(a.callbacks.update.cache.save.before,b,[h,a.parameter,q],a.callbacks.async)||(A(a.history,v,e,x,m,k,l),g(a.callbacks.update.cache.save.after,b,[h,a.parameter,q],a.callbacks.async));d&&d.test("++",1,0,"verify");if(!1!==g(a.callbacks.update.verify.before,b,[h,a.parameter],a.callbacks.async)){if(v===f.location.href)a.retry=
!0;else if(a.retry)a.retry=!1,C(a,b,h,f.location.href,!1,a.cache[h.type.toLowerCase()]?A(a.history,f.location.href):w);else throw Error("throw: location mismatch");g(a.callbacks.update.verify.after,b,[h,a.parameter],a.callbacks.async)}if(!1===g(a.callbacks.update.success,b,[h,a.parameter,m,k,l],a.callbacks.async))break a;if(!1===g(a.callbacks.update.complete,b,[h,a.parameter,m,k,l],a.callbacks.async))break a;if(!1===g(a.callback,b,[h,a.parameter,m,k,l],a.callbacks.async))break a;d&&d.test("++",1,
0,"success")}catch(G){d&&d.test("++",!String(G.message).indexOf("throw:"),G,"catch");d&&d.test("++",!("throw: location mismatch"===G.message&&v!==f.location.href),[v,f.location.href],"!( err.message === 'throw: location mismatch' && url !== win.location.href )");q&&A(a.history,v,e,null);if(!1===g(a.callbacks.update.error,b,[h,a.parameter,m,k,l],a.callbacks.async))break a;if(!1===g(a.callbacks.update.complete,b,[h,a.parameter,m,k,l],a.callbacks.async))break a;d&&d.test("++",1,[v,f.location.href],"error");
if(a.fallback)return"function"===typeof a.fallback?a.fallback(h):H(h,d)}!1!==g(a.callbacks.update.after,b,[h,a.parameter,m,k,l],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("ready"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),d&&d.test("++",1,0,"end"),d&&d.end())}}var f=a.validate?a.validate.clone({name:"jquery.pjax.js - drive()"}):!1;f&&f.start();f&&(f.scope=function(a){return eval(a)});f&&f.test("++",1,[v,h.type],"drive()");a.speedcheck&&(a.log.speed.fire=h.timeStamp);
a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);f&&f.test("++",1,0,"start");if(!1!==g(a.callbacks.before,b,[h,a.parameter],a.callbacks.async))if(p)f&&f.test("++",1,0,"update"),c.when?c.when(I(a.wait)).done(function(){z(p)}):z(p),f&&f.test("++",1,0,"end"),f&&f.end();else{f&&f.test("++",1,0,"initialize");var m,k,l,e,n,x,s={};switch(h.type.toLowerCase()){case "click":f&&
f.test("++",1,0,"event click");s.type="GET";break;case "submit":f&&f.test("++",1,h.target.method,"event submit");s.type=h.target.method.toUpperCase();"POST"===s.type&&(s.data=c(h.target).serializeArray());break;case "popstate":f&&f.test("++",1,0,"event popstate"),s.type="GET"}f&&f.test("++",1,0,"setting");c.extend(!0,s,a.ajax,{xhr:a.callbacks.ajax.xhr?function(){l=g(a.callbacks.ajax.xhr,b,[h,a.parameter],a.callbacks.async);return l=l instanceof Object&&l instanceof r.XMLHttpRequest?l:l||c.ajaxSettings.xhr()}:
w,beforeSend:function(c){l=c;a.xhr&&4>a.xhr.readyState&&a.xhr.abort();a.xhr=l;l.setRequestHeader(a.nss.requestHeader,"true");l.setRequestHeader(a.nss.requestHeader+"-Area",a.area);l.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);l.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);g(a.callbacks.ajax.beforeSend,b,[h,a.parameter,l],a.callbacks.async)},dataFilter:a.callbacks.ajax.dataFilter?function(c,d){m=c;k=d;return g(a.callbacks.ajax.dataFilter,b,[h,a.parameter,m,k],a.callbacks.async)||
m}:w,success:function(f,d,e){m=f;k=d;l=e;g(a.callbacks.ajax.success,b,[h,a.parameter,m,k,l],a.callbacks.async);!c.when&&z()},error:function(c,d,f){l=c;e=d;n=f;(c=a.validate?a.validate.clone({name:"jquery.pjax.js - drive()"}):!1)&&c.start();c&&c.test("++",1,[v,r.location.href,l,e,n],"ajax error");g(a.callbacks.ajax.error,b,[h,a.parameter,l,e,n],a.callbacks.async);if(a.fallback&&"abort"!==e)return"function"===typeof a.fallback?a.fallback(h):H(h,c);c&&c.end()},complete:a.callbacks.ajax.complete?function(c,
d){l=c;e=d;g(a.callbacks.ajax.complete,b,[h,a.parameter,l,e],a.callbacks.async)}:w});s.url=v.replace(/([^#]+)(#[^\s]*)?$/,"$1"+(a.server.query?(v.match(/\?/)?"&":"?")+encodeURIComponent(a.server.query)+"=1":"")+"$2");f&&f.test("++",1,0,"ajax");a.speedcheck&&a.log.speed.name.push("request");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);c.when?c.when(c.ajax(s),I(a.wait)).done(function(){z()}).fail().always():c.ajax(s);!1!==g(a.callbacks.after,b,[h,a.parameter],a.callbacks.async)&&
(f&&f.test("++",1,0,"end"),f&&f.end())}}function g(a,b,c,e){if("function"===typeof a)return e?setTimeout(function(){a.apply(b,c)},0):a.apply(b,c)}function I(a){var b=c.Deferred();if(!a)return b.resolve();setTimeout(function(){b.resolve()},a);return b.promise()}function H(a,b){b&&b.test("++",1,0,"fallback()");b&&b.end();"click"===a.type.toLowerCase()?r.location.href=a.currentTarget.href:"submit"===a.type.toLowerCase()?context.submit():"popstate"===a.type.toLowerCase()&&r.location.reload()}function E(a,
b){var c=[];a.replace(RegExp(b,"gim"),function(a,b){c.push(b)});return c}function B(a,b,c,e){var g,p,n,f,m,k,l,r,w,u,s;n=g=document.createElement("a");n.href=b;n=n.pathname+n.search+n.hash;g.href=c;g=g.pathname+g.search+g.hash;if(g===n)return!0;p=n.replace(/^\//,"").replace(/([?#])/g,"/$1").split("/");m=(e||n).replace(/^\//,"").replace(/([?#])/g,"/$1").split("/");if(e){if(-1===e.indexOf("*"))return!1;f=[];for(var q=m.length;q--;)"*"===m[q]&&f.unshift(p[q])}for(q=m.length+1;q--;)if(w=u=s=!1,p=m.slice(0,
q).join("/").replace(/\/([?#])/g,"$1"),(p="/"+p+("/"===(e||n).charAt(p.length+1)?"/":""))&&p in a){if(!a[p]||!a[p].length)return!1;for(var d=0;k=a[p][d];d++)if(e||"rewrite"!==k||"function"!==typeof a.rewrite)if("inherit"===k)w=!0;else{k=(l="^"===k.charAt(0))?k.slice(1):k;k=(r="*"===k.charAt(0))?k.slice(1):k;if(e)for(var x=0,y=f.length;x<y;x++)k=k.replace("/*/","/"+f[x]+"/");if(!(!l&&u||(r?n.search(k):n.indexOf(k)))){if(l)return!1;u=!0}if(!(!l&&s||(r?g.search(k):g.indexOf(k)))){if(l)return!1;s=!0}}else u=
s=B(a,b,c,a.rewrite.apply(null,[c]));if(u&&s)return!0;if(!w)return u&&s}}function A(a,b,c,e,g,n,r){var f;switch(!0){case a===w||b===w:break;case c===w:a.data[b]&&(new Date).getTime()>a.data[b].timestamp+a.config.expire&&arguments.callee(a,b,null,null);f=a.data[b];break;case null===e:for(var m=0,k;k=a.order[m];m++)b===k&&(a.order.splice(m,1),a.size-=a.data[k].size,a.data[k]=null,delete a.data[k]);break;default:a.order.unshift(b);for(m=1;k=a.order[m];m++)b===k&&a.order.splice(m,1);if(a.data[b])break;
e=e||1.8*g.length;a.size=a.size||0;a.size+=e;a.data[b]={data:null,dataType:n,XMLHttpRequest:r,title:c,size:e,timestamp:(new Date).getTime()};for(m=a.order.length-1;b=a.order[m];m--)if(m>=a.config.length||a.size>a.config.size||(new Date).getTime()>a.data[b].timestamp+a.config.expire)a.order.splice(m,1),a.size=a.size||0,a.size-=a.data[b].size,a.data[b]=null,delete a.data[b]}return f}function J(a,b,e){var g;switch(!0){case b===w:g=c.falsandtru[a];break;case e===w:g=a in c.falsandtru?c.falsandtru[a][b]:
w;break;case e!==w:c.falsandtru[a]instanceof Object||(c.falsandtru[a]={}),c.falsandtru[a][b]instanceof Object&&e instanceof Object?c.extend(!0,c.falsandtru[a][b],e):c.falsandtru[a][b]=e,g=c.falsandtru[a][b]}return g}if("function"===typeof this)return arguments.callee.apply(c(K),arguments);var e=window.validator instanceof Object?window.validator:!1;(e=e?validator.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:y&&y.ajax&&y.ajax.timeout?y.ajax.timeout+e.timeout.limit:e.timeout.limit}}):!1)&&e.start();
e&&e.test("++",1,y,"pjax()");e&&e.test("++",1,0,"initialize");var n=c.extend(!0,{},{id:0,gns:"pjax",ns:null,area:null,link:'a:not([target])[href^="/"]',form:null,scope:null,scrollTop:0,scrollLeft:0,ajax:{},contentType:"text/html",cache:{click:!1,submit:!1,popstate:!1,get:!0,post:!0,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}},rendering:{},verify:{}},async:!1},parameter:null,load:{css:!1,script:!1,
execute:!0,sync:!0,async:0},interval:300,wait:0,fallback:!0,server:{},speedcheck:!1},y),u=[n.gns];e&&e.test("++",1,n,"overwrite");c.extend(!0,n,{nss:{pjax:u.join("."),click:["click"].concat(u.join(":")).join("."),submit:["submit"].concat(u.join(":")).join("."),popstate:["popstate"].concat(u.join(":")).join("."),data:u.join(":"),class4html:u.join("-"),requestHeader:["X",u[0].replace(/^\w/,function(a){return a.toUpperCase()})].join("-"),array:u},server:{query:n.server.query?n.server.query:n.gns},log:{script:{},
speed:{}},history:{config:n.cache,order:[],data:{}},timestamp:(new Date).getTime(),disable:!1,on:function(){for(var a=1,b=x.length;a<b;a++)x[a].disable=!1},off:function(){for(var a=1,b=x.length;a<b;a++)x[a].disable=!0},landing:r.location.href,retry:!0,xhr:null,speed:{now:function(){return(new Date).getTime()}},options:y,validate:e});e&&e.test("++",1,n,"share");c.falsandtru||(c.fn.falsandtru=J,c.falsandtru=J);c.falsandtru("share","history",n.history);n.history=c.falsandtru("share","history");e&&e.test("++",
1,0,"register");"pushState"in r.history&&null!==r.history.pushState&&L(this,n);e&&e.end();return{on:n.on,off:n.off}}})(jQuery);

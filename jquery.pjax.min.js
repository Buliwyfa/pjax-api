/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.18.3
 * @updated 2013/08/28
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(c){var h=window,E=document,q=void 0,v=["settings"];c.fn.pjax=c.pjax=function(t){function K(a,b){b.id=1;v[b.id]=b;b.link&&c(a).undelegate(b.link,b.nss.click).delegate(b.link,b.nss.click,b.id,function(a){a.timeStamp=(new Date).getTime();if(1<a.which||(a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)||(h.location.protocol!==this.protocol||h.location.host!==this.host)||h.location.pathname===this.pathname&&h.location.search===this.search&&h.location.hash!==this.hash)return this;var b,f,q;b=v[a.data];
f=this.href;b.area=m(b.options.area,null,[a])||b.options.area;b.landing&&(b.landing=!1);if(!b.disable&&c(b.area).length)return b.cache[a.type.toLowerCase()]&&(q=w(b.history,f)),B(b,this,a,f,!0,q),a.preventDefault(),!1});b.form&&c(a).undelegate(b.form,b.nss.submit).delegate(b.form,b.nss.submit,b.id,function(a){a.timeStamp=(new Date).getTime();var b,f,q;b=v[a.data];f=this.action;b.area=m(b.options.area,null,[a])||b.options.area;b.landing&&(b.landing=!1);if(!b.disable&&c(b.area).length)return b.cache[a.type.toLowerCase()]&&
(q=w(b.history,f)),B(b,this,a,f,!0,q),a.preventDefault(),!1});c(h).unbind(b.nss.popstate).bind(b.nss.popstate,b.id,function(a){a.timeStamp=(new Date).getTime();var b,f,q;b=v[a.data];f=h.location.href;b.area=m(b.options.area,null,[a])||b.options.area;if(b.landing){if(b.landing===h.location.href){b.landing=!1;return}b.landing=!1}if(!b.disable&&c(b.area).length)return b.cache[a.type.toLowerCase()]&&(q=w(b.history,f)),B(b,this,a,f,!1,q),a.preventDefault(),!1});c("script[src]").each(function(){this.src in
b.log.script||(b.log.script[this.src]=!0)})}function B(a,b,g,r,f,n){function v(e){var d=a.validate?a.validate.clone({name:"jquery.pjax.js - update()"}):!1;d&&d.start();d&&(d.scope=function(a){return eval(a)});d&&d.test("1",1,0,"update()");d&&d.test("++",1,0,"start");a:if(a.speedcheck&&a.log.speed.name.push("update"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==m(a.callbacks.update.before,b,[g,a.parameter,l,p,k],a.callbacks.async)){var u=window,n=document,h,s,t;try{d&&d.test("++",
1,0,"try");d&&d.test("++",1,e?0:[a.contentType,k.getResponseHeader("Content-Type")],"content-type");if(!e&&!RegExp(a.contentType.replace(/\s*[,;]\s*(.|$)/g,function(a,b){return b?"|"+b:""}),"i").test(k.getResponseHeader("Content-Type")))throw Error("throw: content-type mismatch");d&&d.test("++",e?"'usable'":"'unusable'",0,"cache");e&&!1!==m(a.callbacks.update.cache.load.before,b,[g,a.parameter,e],a.callbacks.async)&&(k=e.XMLHttpRequest,l=k.responseText,p=e.dataType,h=e.title,s=e.css,t=e.script,m(a.callbacks.update.cache.load.after,
b,[g,a.parameter,e],a.callbacks.async));d&&d.test("++",1,0,"initialize");var x=c(l),z=0<x.filter("title").length,A=a.area.replace(/(\((.*?(\(.*?\).*?)?)*?\)|\S)(,|$)/g,function(a,b,c,g,d){return b+(d?"|":"")}).split(/\s*\|(?!=)\s*/);h=h?h:z?x.filter("title").text():c("<span/>").html(F(l,"<title>([^<]*)</title>").join()).text();if(!c(a.area).length||!x.find(a.area).add(x.filter(a.area)).length)throw Error("throw: area length mismatch");d&&d.test("++",1,r,"url");if(!1!==m(a.callbacks.update.url.before,
b,[g,a.parameter,l,p,k],a.callbacks.async)){f&&r!==u.location.href&&u.history.pushState(u.history.state,u.opera||-1!==u.navigator.userAgent.toLowerCase().indexOf("opera")?h:n.title,r);switch(!0){case /Mobile(\/\w+)? Safari/i.test(u.navigator.userAgent):a.off(),u.history.back(),u.history.forward(),a.on()}m(a.callbacks.update.url.after,b,[g,a.parameter,l,p,k],a.callbacks.async)}d&&d.test("++",1,h,"title");!1!==m(a.callbacks.update.title.before,b,[g,a.parameter,l,p,k],a.callbacks.async)&&(n.title=h,
m(a.callbacks.update.title.after,b,[g,a.parameter,l,p,k],a.callbacks.async));d&&d.test("++",1,A,"content");if(!1!==m(a.callbacks.update.content.before,b,[g,a.parameter,l,p,k],a.callbacks.async)){c(a.area).children("."+a.nss.class4html+"-check").remove();for(var n=0,C;C=A[n];n++)c(C).html(x.find(C).add(x.filter(C)).contents()).append(c("<div/>",{"class":a.nss.class4html+"-check",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));
c(document).trigger(a.gns+".DOMContentLoaded");m(a.callbacks.update.content.after,b,[g,a.parameter,l,p,k],a.callbacks.async)}d&&d.test("++",1,0,"css");var E=function(){var d=a.validate?a.validate.clone({name:"jquery.pjax.js - load_css()"}):!1;d&&d.start();d&&(d.scope=function(a){return eval(a)});if(!1!==m(a.callbacks.update.css.before,b,[g,a.parameter,l,p,k],a.callbacks.async)){s=s?s:z?x.find('link[rel~="stylesheet"], style').add(x.filter('link[rel~="stylesheet"], style')):F(l,"(<link[^>]*?rel=.[^\"']*stylesheet[^>]*>|<style[^>]*>(.|[\n\r])*?</style>)");
w(a.history,r)&&(w(a.history,r).css=s);c('link[rel~="stylesheet"], style').filter(function(){return c.data(this,a.nss.data,!0)});for(var e=0,f,q=c('link[rel~="stylesheet"]'),h=c("style"),n;f=s[e];e++){n=!1;f=z?f:c(f)[0];switch(f.tagName.toLowerCase()){case "link":if(q.filter(function(){if(n||this.href!==f.href)return!1;n=!0;c.removeData(this,a.nss.data);return!0}).length)continue;break;case "style":if(h.filter(function(){if(n||!c.data(this,a.nss.data)||this.innerHTML!==f.innerHTML)return!1;n=!0;c.removeData(this,
a.nss.data);return!0}).length)continue}c("head").append(f);f=null}c('link[rel~="stylesheet"], style').filter(function(){return c.data(this,a.nss.data)}).remove();c(document).trigger(a.gns+".ready");!1!==m(a.callbacks.update.css.after,b,[g,a.parameter,l,p,k],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}d&&d.end()};a.load.css&&setTimeout(function(){E()},a.load.async||0);!a.load.css&&c(document).trigger(a.gns+".ready");
d&&d.test("++",1,0,"script");var G=function(d){var e=a.validate?a.validate.clone({name:"jquery.pjax.js - load_script()"}):!1;e&&e.start();e&&(e.scope=function(a){return eval(a)});if(!1!==m(a.callbacks.update.script.before,b,[g,a.parameter,l,p,k],a.callbacks.async)){var f=[];t=t?t:z?x.find("script").add(x.filter("script")):F(l,"(?:[^'\"]|^s*)(<script[^>]*>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");w(a.history,r)&&(w(a.history,r).script=t);for(var n=0,h;h=t[n];n++)if(h=z?h:c(h)[0],"sync"!==d||h.defer)"async"===
d&&h.defer||!h.childNodes.length&&h.src in a.log.script||(h.src&&(a.log.script[h.src]=!0),c.when?(h=h.src?c.ajax(c.extend(!0,{},a.ajax,{url:h.src,dataType:"script",async:!1,global:!1})):c.Deferred().resolve(a.load.execute?h:q),f.push(h)):c("head").append(h),h=null);c.when&&f.length&&c.when.apply(null,f).done(function(){for(var a=0,b;b=arguments[a];a++)0<Number(b.nodeType)&&(!b.type||-1<b.type.toLowerCase().indexOf("text/javascript"))&&eval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,
"/*$0*/"))});!1!==m(a.callbacks.update.script.after,b,[g,a.parameter,l,p,k],a.callbacks.async)&&(a.speedcheck&&"async"===d&&a.log.speed.name.push("script"),a.speedcheck&&"async"===d&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}e&&e.end()};a.load.script&&setTimeout(function(){G("async")},a.load.async||0);a.load.script&&!a.load.sync&&setTimeout(function(){G("sync")},a.load.async||0);d&&d.test("++",1,0,"scroll");var I=function(b){var d;switch(g.type.toLowerCase()){case "click":case "submit":d=
b&&"function"===typeof a.scrollLeft?m(a.scrollLeft,null,[g]):a.scrollLeft,d=0<=d?d:0,d=null===d?c(u).scrollLeft():parseInt(Number(d)),b=b&&"function"===typeof a.scrollTop?m(a.scrollTop,null,[g]):a.scrollTop,b=0<=b?b:0,b=null===b?c(u).scrollTop():parseInt(Number(b)),u.scrollTo(d,b)}};I(!1);d&&d.test("++",1,0,"rendering");setTimeout(function(){var d=c(a.area).children("."+a.nss.class4html+"-check");d.filter(function(){return this.clientWidth||c(this).is(":hidden")}).length===d.length?!1!==m(a.callbacks.update.rendering.before,
b,[g,a.parameter],a.callbacks.async)&&(d.remove(),a.load.script&&a.load.sync&&setTimeout(function(){G("sync")},a.load.async||0),I(!0),c(window).trigger(a.gns+".load"),!1!==m(a.callbacks.update.rendering.after,b,[g,a.parameter],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("rendering"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name))):d.length&&setTimeout(function(){arguments.callee()},
a.interval)},0);d&&d.test("++",1,0,"cache");(a.cache.click||a.cache.submit||a.cache.popstate)&&((e||"POST"!==y.type)&&!1!==m(a.callbacks.update.cache.save.before,b,[g,a.parameter,e],a.callbacks.async))&&(w(a.history,r,h,D,l,p,k),m(a.callbacks.update.cache.save.after,b,[g,a.parameter,e],a.callbacks.async));d&&d.test("++",1,0,"verify");if(!1!==m(a.callbacks.update.verify.before,b,[g,a.parameter],a.callbacks.async)){if(r===u.location.href)a.retry=!0;else if(a.retry)a.retry=!1,B(a,b,g,u.location.href,
!1,a.cache[g.type.toLowerCase()]?w(a.history,u.location.href):q);else throw Error("throw: location mismatch");m(a.callbacks.update.verify.after,b,[g,a.parameter],a.callbacks.async)}if(!1===m(a.callbacks.update.success,b,[g,a.parameter,l,p,k],a.callbacks.async))break a;if(!1===m(a.callbacks.update.complete,b,[g,a.parameter,l,p,k],a.callbacks.async))break a;if(!1===m(a.callback,b,[g,a.parameter,l,p,k],a.callbacks.async))break a;d&&d.test("++",1,0,"success")}catch(H){d&&d.test("++",!String(H.message).indexOf("throw:"),
H,"catch");d&&d.test("++",!("throw: location mismatch"===H.message&&r!==u.location.href),[r,u.location.href],"!( err.message === 'throw: location mismatch' && url !== win.location.href )");e&&w(a.history,r,h,null);if(!1===m(a.callbacks.update.error,b,[g,a.parameter,l,p,k],a.callbacks.async))break a;if(!1===m(a.callbacks.update.complete,b,[g,a.parameter,l,p,k],a.callbacks.async))break a;d&&d.test("++",1,[r,u.location.href],"error");if(a.fallback)return"function"===typeof a.fallback?a.fallback(g):J(g,
d)}!1!==m(a.callbacks.update.after,b,[g,a.parameter,l,p,k],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("ready"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),d&&d.test("++",1,0,"end"),d&&d.end())}}var e=a.validate?a.validate.clone({name:"jquery.pjax.js - drive()"}):!1;e&&e.start();e&&(e.scope=function(a){return eval(a)});e&&e.test("++",1,[r,g.type],"drive()");a.speedcheck&&(a.log.speed.fire=g.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=
[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);e&&e.test("++",1,0,"start");if(!1!==m(a.callbacks.before,b,[g,a.parameter],a.callbacks.async))if(n)e&&e.test("++",1,0,"update"),c.when?c.when(A(a.wait)).done(function(){v(n)}):v(n),e&&e.test("++",1,0,"end"),e&&e.end();else{e&&e.test("++",1,0,"initialize");var l,p,k,s,t,D,y={};e&&e.test("++",1,g.type,"switch");switch(g.type.toLowerCase()){case "click":e&&e.test("*",1,0,"click");y.type=
"GET";break;case "submit":e&&e.test("*",1,g.target.method,"submit");r=r.replace(/\?[^\s]*/,"");y.type=g.target.method.toUpperCase();switch(y.type){case "GET":e&&e.test("++",1,c(g.target).serialize(),"serialize"),r+="?"+c(g.target).serialize();case "POST":e&&e.test("++",1,c(g.target).serializeArray(),"serializeArray"),y.data=c(g.target).serializeArray()}break;case "popstate":e&&e.test("*",1,r.match(/\?[^\s]*/),"popstate"),r.match(/\?[^\s]*/),y.type="GET"}e&&e.test("/",1,0,"setting");c.extend(!0,y,
a.ajax,{xhr:a.callbacks.ajax.xhr?function(){k=m(a.callbacks.ajax.xhr,b,[g,a.parameter],a.callbacks.async);return k=k instanceof Object&&k instanceof h.XMLHttpRequest?k:k||c.ajaxSettings.xhr()}:q,beforeSend:function(c){k=c;a.xhr&&4>a.xhr.readyState&&a.xhr.abort();a.xhr=k;k.setRequestHeader(a.nss.requestHeader,"true");k.setRequestHeader(a.nss.requestHeader+"-Area",a.area);k.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);k.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);m(a.callbacks.ajax.beforeSend,
b,[g,a.parameter,k],a.callbacks.async)},dataFilter:a.callbacks.ajax.dataFilter?function(c,d){l=c;p=d;return m(a.callbacks.ajax.dataFilter,b,[g,a.parameter,l,p],a.callbacks.async)||l}:q,success:function(e,d,f){l=e;p=d;k=f;m(a.callbacks.ajax.success,b,[g,a.parameter,l,p,k],a.callbacks.async);!c.when&&v()},error:function(c,d,e){k=c;s=d;t=e;(c=a.validate?a.validate.clone({name:"jquery.pjax.js - drive()"}):!1)&&c.start();c&&c.test("++",1,[r,h.location.href,k,s,t],"ajax error");m(a.callbacks.ajax.error,
b,[g,a.parameter,k,s,t],a.callbacks.async);if(a.fallback&&"abort"!==s)return"function"===typeof a.fallback?a.fallback(g):J(g,c);c&&c.end()},complete:a.callbacks.ajax.complete?function(c,d){k=c;s=d;m(a.callbacks.ajax.complete,b,[g,a.parameter,k,s],a.callbacks.async)}:q});y.url=a.server.query?r.replace(/(#[^\s]*)?$/,(r.match(/\?/)?"&":"?")+encodeURIComponent(a.server.query)+"=1$1"):r;e&&e.test("++",1,0,"ajax");a.speedcheck&&a.log.speed.name.push("request");a.speedcheck&&a.log.speed.time.push(a.speed.now()-
a.log.speed.fire);c.when?c.when(c.ajax(y),A(a.wait)).done(function(){v()}).fail().always():c.ajax(y);!1!==m(a.callbacks.after,b,[g,a.parameter],a.callbacks.async)&&(e&&e.test("++",1,0,"end"),e&&e.end())}}function m(a,b,c,f){if("function"===typeof a)return f?setTimeout(function(){a.apply(b,c)},0):a.apply(b,c)}function A(a){var b=c.Deferred();if(!a)return b.resolve();setTimeout(function(){b.resolve()},a);return b.promise()}function J(a,b){b&&b.test("++",1,0,"fallback()");b&&b.end();"click"===a.type.toLowerCase()?
h.location.href=a.currentTarget.href:"submit"===a.type.toLowerCase()?context.submit():"popstate"===a.type.toLowerCase()&&h.location.reload()}function F(a,b){var c=[];a.replace(RegExp(b,"gim"),function(a,b){c.push(b)});return c}function w(a,b,c,f,h,m,n){var e;switch(!0){case a===q||b===q:break;case c===q:a.data[b]&&(new Date).getTime()>a.data[b].timestamp+a.config.expire&&arguments.callee(a,b,null,null);e=a.data[b];break;case null===f:for(var l=0,p;p=a.order[l];l++)b===p&&(a.order.splice(l,1),a.size-=
a.data[p].size,a.data[p]=null,delete a.data[p]);break;default:a.order.unshift(b);for(l=1;p=a.order[l];l++)b===p&&a.order.splice(l,1);if(a.data[b])break;f=f||1.8*h.length;a.size=a.size||0;a.size+=f;a.data[b]={data:null,dataType:m,XMLHttpRequest:n,title:c,size:f,timestamp:(new Date).getTime()};for(l=a.order.length-1;b=a.order[l];l--)if(l>=a.config.length||a.size>a.config.size||(new Date).getTime()>a.data[b].timestamp+a.config.expire)a.order.splice(l,1),a.size=a.size||0,a.size-=a.data[b].size,a.data[b]=
null,delete a.data[b]}return e}function D(a,b,g){var f;switch(!0){case b===q:f=c.falsandtru[a];break;case g===q:f=a in c.falsandtru?c.falsandtru[a][b]:q;break;case g!==q:c.falsandtru[a]instanceof Object||(c.falsandtru[a]={}),c.falsandtru[a][b]instanceof Object&&g instanceof Object?c.extend(!0,c.falsandtru[a][b],g):c.falsandtru[a][b]=g,f=c.falsandtru[a][b]}return f}if("function"===typeof this)return arguments.callee.apply(c(E),arguments);var f=window.validator instanceof Object?window.validator:!1;
(f=f?validator.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:t&&t.ajax&&t.ajax.timeout?t.ajax.timeout+f.timeout.limit:f.timeout.limit}}):!1)&&f.start();f&&f.test("++",1,t,"pjax()");f&&f.test("++",1,0,"initialize");var n=c.extend(!0,{},{id:0,gns:"pjax",ns:q,area:q,link:'a:not([target])[href^="/"]',form:q,scrollTop:0,scrollLeft:0,ajax:{},contentType:"text/html",cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},
content:{},css:{},script:{},cache:{load:{},save:{}},rendering:{},verify:{}},async:!1},parameter:q,load:{css:!1,script:!1,execute:!0,sync:!0,async:0},interval:300,wait:0,fallback:!0,server:{},speedcheck:!1},t),s=[n.gns];f&&f.test("++",1,n,"overwrite");c.extend(!0,n,{nss:{pjax:s.join("."),click:["click"].concat(s.join(":")).join("."),submit:["submit"].concat(s.join(":")).join("."),popstate:["popstate"].concat(s.join(":")).join("."),data:s.join(":"),class4html:s.join("-"),requestHeader:["X",s[0].replace(/^\w/,
function(a){return a.toUpperCase()})].join("-"),array:s},server:{query:n.server.query===q?n.gns:n.server.query},log:{script:{},speed:{}},history:{config:n.cache,order:[],data:{}},timestamp:(new Date).getTime(),disable:!1,on:function(){for(var a=1,b=v.length;a<b;a++)v[a].disable=!1},off:function(){for(var a=1,b=v.length;a<b;a++)v[a].disable=!0},landing:h.location.href,retry:!0,xhr:null,speed:{now:function(){return(new Date).getTime()}},options:t,validate:f});f&&f.test("++",1,n,"share");c.falsandtru||
(c.fn.falsandtru=D,c.falsandtru=D);c.falsandtru("share","history",n.history);n.history=c.falsandtru("share","history");f&&f.test("++",1,0,"register");"pushState"in h.history&&null!==h.history.pushState&&K(this,n);f&&f.end();return{on:n.on,off:n.off}}})(jQuery);
